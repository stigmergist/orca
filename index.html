<!DOCTYPE html>
<html lang="en">
<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>ORCA - Marine Sightings Map</title>
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script src="sightings.js" type="text/javascript"></script>
	<style>
		* {
			box-sizing: border-box;
		}
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
		}
		body {
			display: flex;
			flex-direction: column;
		}
		#map {
			flex: 1;
			min-height: 600px;
			width: 100%;
		}
		.leaflet-container {
			font-family: inherit;
		}
		.info-banner {
			padding: 1rem;
			background-color: #f5f5f5;
			border-bottom: 1px solid #ddd;
		}
		.info-banner h1 {
			margin: 0;
			font-size: 1.5rem;
		}
		.info-banner p {
			margin: 0.5rem 0 0 0;
			color: #666;
		}
	</style>

	
</head>
<body>

<header class="info-banner">
	<h1>ORCA Marine Wildlife Sightings</h1>
	<p>From aboard CalMac vessels between March and October 2025</p>
</header>

<div id="map" aria-label="Interactive map of marine sightings"></div>

<script>
	// Configuration
	const MAP_CONFIG = {
		center: [56.874, -5.757],
		zoom: 7.5,
		maxZoom: 19,
	};

	const MARKER_COLOURS =  {
			"Porpoise": 'red',
			"Seal": 'green',
			"Whale": 'blue',
			"Dolphin": 'yellow',
			"Other": 'orange',
			"Shark": 'white',
		};

	const ANIMAL_IMAGES = {
		"Common (harbour) seal" : "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/05_Pregnant_female_common_seal_in_SSSI_MacLeod_Estate_%28Cuillin%29_by_Romaniviatores.jpg/330px-05_Pregnant_female_common_seal_in_SSSI_MacLeod_Estate_%28Cuillin%29_by_Romaniviatores.jpg",
		"Grey seal" : "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Grey_Seal%2C_Dunoon%2C_Scotland_%284932697233%29.jpg/330px-Grey_Seal%2C_Dunoon%2C_Scotland_%284932697233%29.jpg",
		"Common dolphin" : "https://upload.wikimedia.org/wikipedia/commons/e/ef/Common_dolphin_-_geograph.org.uk_-_4575862.jpg",
	}

	const ANIMAL_COPYRIGHTS = {
		"Common (harbour) seal" : "By Romaniviatores, <a href='https://commons.wikimedia.org/wiki/File:05_Pregnant_female_common_seal_in_SSSI_MacLeod_Estate_(Cuillin)_by_Romaniviatores.jpg'>CC BY-SA 4.0</a>",
		"Grey seal" : "By Phil Sangwell, <a href='https://commons.wikimedia.org/wiki/File:Grey_Seal,_Dunoon,_Scotland_(4932697233).jpg'>CC BY-SA 2.0</a>",
		"Common dolphin" : "By John Allan, <a href='https://commons.wikimedia.org/wiki/File:Common_dolphin_-_geograph.org.uk_-_4575862.jpg'>CC BY-SA 2.0</a>",
	}

	const OSM_ATTRIBUTION = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';
	const SG_ATTRIBUTION = '&copy; <a href="https://www.data.gov.uk/dataset/68bfec84-4094-4ad8-a1f2-87ac5ce55673/scottish-ferry-routes">Scottish Government</a>';
	const ORCA_ATTRIBUTION = '&copy; <a href="https://orca.org.uk/">ORCA UK</a>';
	const WMS_URL = 'https://maps.gov.scot/server/services/ScotGov/TransportNetworks/MapServer/WMSServer';

	// Initialize map
	const map = L.map('map', { zoomSnap: 0.5 }).setView(MAP_CONFIG.center, MAP_CONFIG.zoom);

	// Add base layers
	const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: MAP_CONFIG.maxZoom,
		attribution: OSM_ATTRIBUTION,
	}).addTo(map);

	// Add Scottish ferry routes layer
	const routesLayer = L.tileLayer.wms(WMS_URL, {
		layers: ['ScottishFerryRoutes', 'ScottishFerryPorts'],
		format: 'image/png',
		transparent: true,
		attribution: SG_ATTRIBUTION,
	}).addTo(map);

	// Build overlay layers from sightings data
	const baseMaps = {};
	const overlayMaps = {
		'Ferry Routes': routesLayer,
	};

	if (typeof sightings_map === 'undefined') {
		console.error('Sightings data not loaded. Check sightings.js file.');
	} else {
		for (const [speciesName, geojsonData] of Object.entries(sightings_map)) {
			const layer = L.geoJSON(geojsonData, {
				pointToLayer: function (feature, latlng) {
					return L.circleMarker(latlng, {
						radius: 5,
						fillColor: MARKER_COLOURS[speciesName] || '#3388ff',
						color: '#000',
						weight: 1,
						opacity: 1,
						fillOpacity: 0.8,
						minZoom: 5,
					});
				},
				attribution: ORCA_ATTRIBUTION,
				onEachFeature: function(feature, layer){
					content = "<B>"+feature.properties["species"]+"</B><br/>";
					content += "Date: " + feature.properties["obs_date"] + "<br/>";
					content += "From the <i>MV " + feature.properties["vessel"] + "</i><br/>";
					content += " on "+feature.properties["from_port"]+"-"+feature.properties["to_port"]+ " route <br/>";
					if (feature.properties["species"] in ANIMAL_IMAGES) {
						content += "<img src='"+ANIMAL_IMAGES[feature.properties["species"]]+"' width=180 /> <br/>"
						content += "<small>"+ANIMAL_COPYRIGHTS[feature.properties["species"]]+"</small><br/>";
					}
					layer.bindTooltip(content);
					layer.bindPopup(content);
				}
			}).addTo(map);
			overlayMaps[speciesName] = layer;
		}
	}

	// Add layer control
	L.control.layers(baseMaps, overlayMaps).addTo(map);
</script>



</body>
</html>
